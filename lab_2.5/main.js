ispolniteli = [
    { 'Псевдоним': 'LOBODA', 'Страна': 'Украина', 'Родной город': 'Киев', 'Возраст': 39, 'Количество прослушиваний': 51234981234, 'Количество слушателей в месяц': 92347238 },
    { 'Псевдоним': 'Макс Корж', 'Страна': 'Беларусь', 'Родной город': 'Минск', 'Возраст': 36, 'Количество прослушиваний': 48237498234, 'Количество слушателей в месяц': 103487239 },
    { 'Псевдоним': 'Artik & Asti', 'Страна': 'Россия', 'Родной город': 'Архангельск', 'Возраст': 35, 'Количество прослушиваний': 38342798342, 'Количество слушателей в месяц': 120394782 },
    { 'Псевдоним': 'Егор Крид', 'Страна': 'Россия', 'Родной город': 'Пенза', 'Возраст': 28, 'Количество прослушиваний': 45341287934, 'Количество слушателей в месяц': 150234782 },
    { 'Псевдоним': 'Хаски', 'Страна': 'Россия', 'Родной город': 'Сибай', 'Возраст': 36, 'Количество прослушиваний': 31238912783, 'Количество слушателей в месяц': 85342782 },
    { 'Псевдоним': 'Мот', 'Страна': 'Россия', 'Родной город': 'Североуральск', 'Возраст': 32, 'Количество прослушиваний': 59347829342, 'Количество слушателей в месяц': 100342782 },
    { 'Псевдоним': 'Элджей', 'Страна': 'Россия', 'Родной город': 'Москва', 'Возраст': 28, 'Количество прослушиваний': 41234981234, 'Количество слушателей в месяц': 92347238 },
    { 'Псевдоним': 'Noize MC', 'Страна': 'Россия', 'Родной город': 'Бердск', 'Возраст': 38, 'Количество прослушиваний': 38237498234, 'Количество слушателей в месяц': 103487239 },
    { 'Псевдоним': 'Lady Gaga', 'Страна': 'США', 'Родной город': 'Нью-Йорк', 'Возраст': 35, 'Количество прослушиваний': 56341237842, 'Количество слушателей в месяц': 92387412 },
    { 'Псевдоним': 'Eminem', 'Страна': 'США', 'Родной город': 'Детройт', 'Возраст': 49, 'Количество прослушиваний': 67293481723, 'Количество слушателей в месяц': 103487823 },
    { 'Псевдоним': 'Beyoncé', 'Страна': 'США', 'Родной город': 'Хьюстон', 'Возраст': 40, 'Количество прослушиваний': 82374981732, 'Количество слушателей в месяц': 120394782 },
    { 'Псевдоним': 'Adele', 'Страна': 'Великобритания', 'Родной город': 'Лондон', 'Возраст': 33, 'Количество прослушиваний': 95341287934, 'Количество слушателей в месяц': 150234782 },
    { 'Псевдоним': 'Elton John', 'Страна': 'Великобритания', 'Родной город': 'Пинбетон', 'Возраст': 74, 'Количество прослушиваний': 41238912783, 'Количество слушателей в месяц': 85342782 },
    { 'Псевдоним': 'Madonna', 'Страна': 'США', 'Родной город': 'Бэй-Сити', 'Возраст': 63, 'Количество прослушиваний': 69347829342, 'Количество слушателей в месяц': 100342782 },
    { 'Псевдоним': 'Джизус', 'Страна': 'Россия', 'Родной город': 'Киров', 'Возраст': 26, 'Количество прослушиваний': 265864000, 'Количество слушателей в месяц': 766020 },
    { 'Псевдоним': 'Friendly Thug 52 NGG', 'Страна': 'Россия', 'Родной город': 'Санкт-Петербург', 'Возраст': 23, 'Количество прослушиваний': 78364130, 'Количество слушателей в месяц': 857771 },
    { 'Псевдоним': 'Drake', 'Страна': 'Канада', 'Родной город': 'Торонто', 'Возраст': 36, 'Количество прослушиваний': 75186501142, 'Количество слушателей в месяц': 105941627 },
    { 'Псевдоним': 'ASAP Rocky', 'Страна': 'США', 'Родной город': 'Нью-Йорк', 'Возраст': 35, 'Количество прослушиваний': 11569121874, 'Количество слушателей в месяц': 43551567 },
    { 'Псевдоним': 'Katy Perry', 'Страна': 'США', 'Родной город': 'Санта-Барбара', 'Возраст': 38, 'Количество прослушиваний': 46319431142, 'Количество слушателей в месяц': 85421551 },
    { 'Псевдоним': 'Morgenstern', 'Страна': 'Россия', 'Родной город': 'Уфа', 'Возраст': 25, 'Количество прослушиваний': 3432763521, 'Количество слушателей в месяц': 5156517 },
    { 'Псевдоним': 'Big Baby Tape', 'Страна': 'Россия', 'Родной город': 'Москва', 'Возраст': 23, 'Количество прослушиваний': 784410000, 'Количество слушателей в месяц': 2756517 },
    { 'Псевдоним': 'zxcursed', 'Страна': 'Украина', 'Родной город': 'Киев', 'Возраст': 16, 'Количество прослушиваний': 154214213, 'Количество слушателей в месяц': 2316413 },
    { 'Псевдоним': 'Kizaru', 'Страна': 'Россия', 'Родной город': 'Санкт-Петербург', 'Возраст': 34, 'Количество прослушиваний': 1634356652, 'Количество слушателей в месяц': 2104213 },
    { 'Псевдоним': 'Billie Eilish', 'Страна': 'США', 'Родной город': 'Лос-Анджелес', 'Возраст': 22, 'Количество прослушиваний': 45923418732, 'Количество слушателей в месяц': 65973812 },
    { 'Псевдоним': 'Post Malone', 'Страна': 'США', 'Родной город': 'Сиракьюз', 'Возраст': 28, 'Количество прослушиваний': 37621867423, 'Количество слушателей в месяц': 75946712 },
    { 'Псевдоним': 'Lil Nas X', 'Страна': 'США', 'Родной город': 'Лития-Спрингс', 'Возраст': 25, 'Количество прослушиваний': 12432651784, 'Количество слушателей в месяц': 35487214 },
    { 'Псевдоним': 'Ariana Grande', 'Страна': 'США', 'Родной город': 'Бока-Ратон', 'Возраст': 30, 'Количество прослушиваний': 61324587194, 'Количество слушателей в месяц': 92345872 },
    { 'Псевдоним': 'The Weeknd', 'Страна': 'Канада', 'Родной город': 'Торонто', 'Возраст': 34, 'Количество прослушиваний': 78236751482, 'Количество слушателей в месяц': 120345872 },
    { 'Псевдоним': 'Travis Scott', 'Страна': 'США', 'Родной город': 'Хьюстон', 'Возраст': 32, 'Количество прослушиваний': 52347812903, 'Количество слушателей в месяц': 82451723 },
    { 'Псевдоним': 'Doja Cat', 'Страна': 'США', 'Родной город': 'Лос-Анджелес', 'Возраст': 28, 'Количество прослушиваний': 20458974321, 'Количество слушателей в месяц': 63451723 },
    { 'Псевдоним': 'Ed Sheeran', 'Страна': 'Великобритания', 'Родной город': 'Фрамлингем', 'Возраст': 33, 'Количество прослушиваний': 65231874598, 'Количество слушателей в месяц': 85412345 },
    { 'Псевдоним': 'Harry Styles', 'Страна': 'Великобритания', 'Родной город': 'Реддитч', 'Возраст': 30, 'Количество прослушиваний': 23459871234, 'Количество слушателей в месяц': 73451721 },
    { 'Псевдоним': 'Dua Lipa', 'Страна': 'Великобритания', 'Родной город': 'Лондон', 'Возраст': 28, 'Количество прослушиваний': 30247581923, 'Количество слушателей в месяц': 60451723 },
    { 'Псевдоним': 'Kanye West', 'Страна': 'США', 'Родной город': 'Атланта', 'Возраст': 46, 'Количество прослушиваний': 74851783412, 'Количество слушателей в месяц': 82451723 },
    { 'Псевдоним': 'Rihanna', 'Страна': 'Барбадос', 'Родной город': 'Сент-Майкл', 'Возраст': 36, 'Количество прослушиваний': 58347129384, 'Количество слушателей в месяц': 82451723 },
    { 'Псевдоним': 'BTS', 'Страна': 'Южная Корея', 'Родной город': 'Сеул', 'Возраст': 29, 'Количество прослушиваний': 87458371234, 'Количество слушателей в месяц': 125345823 },
    { 'Псевдоним': 'Shawn Mendes', 'Страна': 'Канада', 'Родной город': 'Пикеринг', 'Возраст': 25, 'Количество прослушиваний': 18234571923, 'Количество слушателей в месяц': 63451723 },
    { 'Псевдоним': 'Justin Bieber', 'Страна': 'Канада', 'Родной город': 'Стратфорд', 'Возраст': 30, 'Количество прослушиваний': 76234587123, 'Количество слушателей в месяц': 95412345 },
    { 'Псевдоним': 'Cardi B', 'Страна': 'США', 'Родной город': 'Нью-Йорк', 'Возраст': 31, 'Количество прослушиваний': 24357891234, 'Количество слушателей в месяц': 73451721 },
    { 'Псевдоним': 'J Balvin', 'Страна': 'Колумбия', 'Родной город': 'Медельин', 'Возраст': 38, 'Количество прослушиваний': 57384571323, 'Количество слушателей в месяц': 83451723 },
    { 'Псевдоним': 'Bad Bunny', 'Страна': 'Пуэрто-Рико', 'Родной город': 'Вега-Баха', 'Возраст': 30, 'Количество прослушиваний': 81234571323, 'Количество слушателей в месяц': 110345823 },
    { 'Псевдоним': 'Camila Cabello', 'Страна': 'США', 'Родной город': 'Гавана', 'Возраст': 27, 'Количество прослушиваний': 23457891234, 'Количество слушателей в месяц': 63451723 },
    { 'Псевдоним': 'Selena Gomez', 'Страна': 'США', 'Родной город': 'Гранд-Прери', 'Возраст': 31, 'Количество прослушиваний': 43257891234, 'Количество слушателей в месяц': 73451721 }
];


const marginX = 100;
const marginY = 70;
const height = 800;
const width = 1000;

let svg = d3.select("svg").attr("height", height).attr("width", width);
let currentTable = ispolniteli;
let createTable = (data, idTable) => {
    let table = document.getElementById(idTable);
    let tr = document.createElement('tr');
    for (key in data[0]) {
        let th = document.createElement('th');
        th.innerHTML = key;
        tr.append(th);
    }
    table.append(tr);
    data.forEach((item) => {
        let row = document.createElement('tr');
        for (key in item) {
            let cell = document.createElement('td');
            cell.innerHTML = item[key];
            row.appendChild(cell);
        }
        table.appendChild(row);
    });
  }
  let correspond = {
    'Псевдоним': 'name',
    'Страна': 'country',
    'Родной город': 'city',
    'Возраст': ["yearFrom", "yearTo"],
    'Количество прослушиваний': ["kolFrom", "kolTo"],
    'Количество слушателей в месяц': ["kolmonthFrom", "kolmonthTo"],
  }
  
  function resetTable() {
    createTable(ispolniteli, 'list');
    currentTable = ispolniteli.slice();
}

  let dataFilter = (dataForm) => {
    let dictFilter = {};
    for (let j = 0; j < dataForm.elements.length; j++) {
        let item = dataForm.elements[j];
        let valInput = item.value;
        if (item.type == "text") {
            valInput = valInput.toLowerCase();
        } else if (item.type == "number") {
            if (valInput !== "") {
                valInput = parseFloat(valInput);
            } else {
                if (item.id.includes("From")) {
                    valInput = Number.NEGATIVE_INFINITY;
                } else if (item.id.includes("To")) {
                    valInput = Number.POSITIVE_INFINITY;
                }
            }
        }
        dictFilter[item.id] = valInput;
    }
    return dictFilter;
  }
  
  let removeAllRows = (idTable) => {
    let table = document.getElementById(idTable);
    if (table) {
        while (table.rows.length > 0) {
            table.deleteRow(-1);
        }
    }
  }
  
  let filterTable = (data, idTable, dataForm) => {
    let datafilter = dataFilter(dataForm);
    let tableFilter = data.filter(item => {
        let result = true;
        for (let key in item) {
            let val = item[key];
            if (isNaN(Number(val))) {
                val = item[key].toLowerCase()
                result &&= val.indexOf(datafilter[correspond[key]]) !== -1 //Ищем подстроку 
            }
            if (!isNaN(Number(val))) {
                val = Number(val)
                result &&= (val >= datafilter[correspond[key][0]] && val <= datafilter[correspond[key][1]]) 
            }
        }
        return result;
    });
    removeAllRows(idTable);
    createTable(tableFilter, idTable);
  }
  
  let clearFilter = (idTable, formData) => {
    let formElements = formData.elements;
    for (let i = 0; i < formElements.length; i++) {
        let element = formElements[i];
        if (element.type === 'text' || element.type === 'number') {
            element.value = '';
        }
    }
    removeAllRows(idTable);
    createTable(ispolniteli, 'list');
  }
  
  ///
  let selectedOptions = {}
  
  let createOption = (str, val) => {
    let item = document.createElement('option');
    item.text = str;
    item.value = val;
    return item;
  }
  
  let setSortSelect = (head, sortSelect) => {
    sortSelect.append(createOption('Нет', 0));
    for (let i in head) {
        let option = createOption(head[i], Number(i) + 1)
        sortSelect.append(option);
        selectedOptions[option.value] = false
    }
  }
  
  let setSortSelects = (data, dataForm) => {
    let head = Object.keys(data);
    let allSelect = dataForm.getElementsByTagName('select');
    for (let j = 0; j < allSelect.length; j++) {
        setSortSelect(head, allSelect[j]);
        if (j != 0) {
            allSelect[j].disabled = true;
        }
    }
  }
  
  let changeNextSelect = (nextSelectId, curSelect) => {
  
    let nextSelect = document.getElementById(nextSelectId);
    nextSelect.disabled = false;
    selectedOptions[curSelect.oldValue] = false
    nextSelect.innerHTML = curSelect.innerHTML;
    if (curSelect.value != 0) {
        selectedOptions[curSelect.value] = true
        for (let key in selectedOptions) {
            if (selectedOptions[key]) {
                let options = nextSelect.options
                for (let index = 0; index < options.length; index++) {
                    if (options[index].value == key) {
                        nextSelect.remove(index)
                    }
                }
            }
        }
    } else {
        let allSelect = document.getElementById('sort').getElementsByTagName('select');
        let allSelectArray = Array.from(allSelect)
        for (let j = allSelectArray.indexOf(curSelect); j < allSelect.length; j++) {
            selectedOptions[allSelect[j].oldValue] = false
            allSelect[j].value = 0
            if (j != allSelectArray.indexOf(curSelect)) {
                allSelect[j].disabled = true
            }
  
        }
    }
    curSelect.oldValue = curSelect.value
  }
  
  let createSortArr = (data) => {
    let sortArr = [];
    let sortSelects = data.getElementsByTagName('select');
    for (let i = 0; i < sortSelects.length; i++) {
        let keySort = sortSelects[i].value;
        if (keySort == 0) {
            break;
        }
        let desc = document.getElementById(sortSelects[i].id + 'Desc').checked;
        sortArr.push({ column: keySort - 1, order: desc });
    }
    return sortArr;
  };
  
  
  let sortTable = (idTable, data) => {
    let sortArr = createSortArr(data);
    if (sortArr.length === 0) {
        return false;
    }
    let table = document.getElementById(idTable);
    let rowData = Array.from(table.rows);
    rowData.shift();
    rowData.sort((first, second) => {
        for (let i = 0; i < sortArr.length; i++) {
            let key = sortArr[i].column;
            let order = sortArr[i].order;
            if (order) {
                if (key == 3) {
                    if (Number(first.cells[key].innerHTML) < Number(second.cells[key].innerHTML)) {
                        return 1;
                    } else if (Number(first.cells[key].innerHTML) > Number(second.cells[key].innerHTML)) {
                        return -1;
                    }
                } else {
                    if (first.cells[key].innerHTML < second.cells[key].innerHTML) {
                        return 1;
                    } else if (first.cells[key].innerHTML > second.cells[key].innerHTML) {
                        return -1;
                    }
                }
            } else {
                if (key == 3) {
                    if (Number(first.cells[key].innerHTML) > Number(second.cells[key].innerHTML)) {
                        return 1;
                    } else if (Number(first.cells[key].innerHTML) < Number(second.cells[key].innerHTML)) {
                        return -1;
                    }
                } else {
                    if (first.cells[key].innerHTML > second.cells[key].innerHTML) {
                        return 1;
                    } else if (first.cells[key].innerHTML < second.cells[key].innerHTML) {
                        return -1;
                    }
                }
            }
  
        }
        return 0;
    });
    table.innerHTML = table.rows[0].innerHTML;
    rowData.forEach(item => {
        table.append(item);
    });
  }
  
  function resetSort(idTable) {
    removeAllRows(idTable)
    createTable(ispolniteli, 'list');
    for (let key in selectedOptions) {
        selectedOptions[key] = false
    }
    let allSelect = document.getElementById('sort').getElementsByTagName('select');
    for (let j = 0; j < allSelect.length; j++) {
        if (j != 0) {
            allSelect[j].disabled = true
        }
        allSelect[j].value = 0
    }
  }
  
  function createArrGraph(data, key) {
    const groupObj = d3.group(data, d => d[key]);
    let arrGraph = [];
    for (let entry of groupObj) {
        let values = entry[1].map(d => parseFloat(d['Количество слушателей в месяц']));
        let minMax = d3.extent(values);
        arrGraph.push({ labelX: entry[0], values: minMax });
    }
    return arrGraph;
}

const createAxis = (data, showMin, showMax) => {
    let min, max;
    if (showMin && showMax) {
        min = d3.min(data, d => d3.min(d.values));
        max = d3.max(data, d => d3.max(d.values));
    } else if (showMin) {
        min = d3.min(data, d => d.values[0]);
        max = d3.max(data, d => d.values[0]);
    } else if (showMax) {
        min = d3.min(data, d => d.values[1]);
        max = d3.max(data, d => d.values[1]);
    } else {
        min = 0;
        max = 0;
    }

    let scaleX = d3.scaleBand()
        .domain(data.map((d) => d.labelX))
        .range([0, width - 2 * marginX]);

    let scaleY = d3.scaleLinear()
        .domain([Math.min(min, 0), max])
        .range([height - 2 * marginY, 0]);

    let axisX = d3.axisBottom(scaleX); 
    let axisY = d3.axisLeft(scaleY)
        .ticks(20);

    svg.append("g")
        .attr("transform", `translate(${marginX}, ${height - marginY})`)
        .call(axisX)
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)");

    svg.append("g")
        .attr("transform", `translate(${marginX}, ${marginY})`)
        .call(axisY);

    return [scaleX, scaleY];
};


function createBarChart(arrGraph, scaleX, scaleY, isMin, isMax) {
    const barWidth = scaleX.bandwidth() / 3; // ширина столбца
    const offset = (scaleX.bandwidth() - barWidth) / 2; // сдвиг для центрирования одного столбца

    if (isMin && !isMax) {
        svg.selectAll(".bar0")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("class", "bar0")
            .attr("x", (d) => scaleX(d.labelX) + offset)
            .attr("y", (d) => scaleY(d.values[0]))
            .attr("width", barWidth)
            .attr("height", (d) => height - 2 * marginY - scaleY(d.values[0]))
            .attr("transform", `translate(${marginX}, ${marginY})`)
            .style("fill", "blue");
    }

    if (!isMin && isMax) {
        svg.selectAll(".bar1")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("class", "bar1")
            .attr("x", (d) => scaleX(d.labelX) + offset)
            .attr("y", (d) => scaleY(d.values[1]))
            .attr("width", barWidth)
            .attr("height", (d) => height - 2 * marginY - scaleY(d.values[1]))
            .attr("transform", `translate(${marginX}, ${marginY})`)
            .style("fill", "red");
    }

    if (isMin && isMax) {
        const doubleOffset = (scaleX.bandwidth() - barWidth * 2) / 2; // сдвиг для центрирования двух столбцов

        svg.selectAll(".bar0")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("class", "bar0")
            .attr("x", (d) => scaleX(d.labelX) + doubleOffset)
            .attr("y", (d) => scaleY(d.values[0]))
            .attr("width", barWidth)
            .attr("height", (d) => height - 2 * marginY - scaleY(d.values[0]))
            .attr("transform", `translate(${marginX}, ${marginY})`)
            .style("fill", "blue");

        svg.selectAll(".bar1")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("class", "bar1")
            .attr("x", (d) => scaleX(d.labelX) + doubleOffset + barWidth)
            .attr("y", (d) => scaleY(d.values[1]))
            .attr("width", barWidth)
            .attr("height", (d) => height - 2 * marginY - scaleY(d.values[1]))
            .attr("transform", `translate(${marginX}, ${marginY})`)
            .style("fill", "red");
    }
}



function createPoints(arrGraph, scaleX, scaleY, index, color) {
    const r = 4;
    let ident = 0;

    if (index === 0) {
        const minMaxY = d3.extent(arrGraph, d => d.values[index]);
        if (minMaxY[0] === minMaxY[1]) {
            ident = r / 2;
        }
    }

    svg.selectAll(".dot" + index)
        .data(arrGraph)
        .enter()
        .append("circle")
        .attr("class", "dot" + index)
        .attr("r", r)
        .attr("cx", (d) => scaleX(d.labelX) + scaleX.bandwidth() / 2)
        .attr("cy", (d) => scaleY(d.values[index]) + ident)
        .attr("transform", `translate(${marginX}, ${marginY})`)
        .style("fill", color);
}


function drawGraph(data) {
    const keyX = data.ox.value;
    const isMin = data.oy[1].checked;
    const isMax = data.oy[0].checked;
    
    // Сортировка данных по ключу оси ox (если возраст числовой, иначе используйте правильную логику сортировки)
    currentTable.sort((a, b) => {
        if (a[keyX] < b[keyX]) return -1;
        if (a[keyX] > b[keyX]) return 1;
        return 0;
    });

    const arrGraph = createArrGraph(currentTable, keyX);

    svg.selectAll('*').remove();

    const [scX, scY] = createAxis(arrGraph, isMin, isMax);

    if (isMin) {
        createPoints(arrGraph, scX, scY, 0, "blue");
    }
    if (isMax) {
        createPoints(arrGraph, scX, scY, 1, "red");
    }
}

function drawBarGraph(data) {
    const keyX = data.ox.value;
    const isMin = data.oy[1].checked;
    const isMax = data.oy[0].checked;
    const arrGraph = createArrGraph(currentTable, keyX);

    svg.selectAll('*').remove();

    const [scX, scY] = createAxis(arrGraph, isMin, isMax);

    createBarChart(arrGraph, scX, scY, isMin, isMax);
}   




document.addEventListener("DOMContentLoaded", function () {
    createTable(ispolniteli, 'list');
    let sortForm = document.getElementById('sort');
    setSortSelects(ispolniteli[0], sortForm);

    let findButton = document.getElementById('find');
    findButton.addEventListener('click', function () {
        let dataForm = document.getElementById('filter');
        filterTable(ispolniteli, 'list', dataForm);
    });

    let clearButton = document.getElementById('clearFilters');
    clearButton.addEventListener('click', function () {
        let formData = document.getElementById('filter');
        clearFilter('list', formData);
    });

    document.getElementById('fieldsFirst').onchange = () => {
        changeNextSelect('fieldsSecond', document.getElementById('fieldsFirst'));
        if (document.getElementById('fieldsFirst').value == 0) {
            resetSort('list');
            document.getElementById('fieldsFirstDesc').checked = false;
            document.getElementById('fieldsSecondDesc').checked = false;
            document.getElementById('fieldsThirdDesc').checked = false;
        }
    };

    document.getElementById('fieldsSecond').onchange = () => {
        changeNextSelect('fieldsThird', document.getElementById('fieldsSecond'));
        if (document.getElementById('fieldsSecond').value == 0) {
            sortTable('list', document.getElementById('sort'));
            document.getElementById('fieldsSecondDesc').checked = false;
            document.getElementById('fieldsThirdDesc').checked = false;
        }
    };

    document.getElementById('fieldsThird').onchange = () => {
        if (document.getElementById('fieldsThird').value == 0) {
            document.getElementById('fieldsThirdDesc').checked = false;
        }
    };

    function resetSort(idTable) {
        let formData = document.getElementById('filter');
        filterTable(cars, idTable, formData);
        for (let key in selectedOptions) {
            selectedOptions[key] = false;
        }
        let allSelect = document.getElementById('sort').getElementsByTagName('select');
        for (let j = 0; j < allSelect.length; j++) {
            if (j != 0) {
                allSelect[j].disabled = true;
            }
            allSelect[j].value = 0;
        }
    }

    function resetGraphSettings() {
        document.querySelector('input[name="ox"][value="Возраст"]').checked = true;
        document.querySelectorAll('input[name="oy"]').forEach(input => input.checked = false);
    }

    let resetGraphButton = document.getElementById('resetGraphButton');
    resetGraphButton.addEventListener('click', function() {
        resetGraph();
        resetGraphSettings();
    });

    function resetGraph() {
        svg.selectAll('*').remove();
    }

    let sortButton = document.getElementById('sortbutton');
    sortButton.addEventListener('click', function () {
        let formData = document.getElementById('sort');
        sortTable('list', formData);
    });

    let resetButton = document.getElementById('resetsort');
    resetButton.addEventListener('click', function () {
        resetSort('list');
    });
    let barGraphButton = document.getElementById('barGraphButton');
    barGraphButton.addEventListener('click', function() {
        let formData = document.getElementById('graphForm');
        drawBarGraph(formData);
    });

});